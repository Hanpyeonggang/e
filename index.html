<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EVERYTHING EVERYWHERE ALL AT ONCE (Video Background)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display.swap" rel="stylesheet">
  
<style>
/* -------------------- CSS ì½”ë“œ ì‹œì‘ -------------------- */
@font-face {
    font-family: 'JoseonGulim';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff');
    font-weight: normal;
    font-display: swap;
}

* { margin:0; padding:0; box-sizing:border-box; }
html, body {
    width:100%; height:100%; overflow:hidden; 
    background: #ffffff;
    font-family: 'JoseonGulim', 'Noto Sans KR', sans-serif;
    cursor: none;
    position: relative;
}

#background-container { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    z-index: 1; 
}

/* ì›¹ìº ìš© ë¹„ë””ì˜¤ (ì´ì œ ì‚¬ìš© ì•ˆ í•¨) */
#webcamVideo { 
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    object-fit: cover; display: none; z-index: 1; opacity: 0;
    transform: scaleX(-1); 
    transition: opacity 2s ease-in-out; /* ì„œì„œíˆ ë‚˜íƒ€ë‚˜ëŠ” íš¨ê³¼ */
} 

/* ë°°ê²½ ë™ì˜ìƒìš© ë¹„ë””ì˜¤ ìš”ì†Œ */
#backgroundVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    display: none;     /* í‰ì†Œì—” ìˆ¨ê²¨ ë‘  */
    z-index: 1;        /* íŒŒí‹°í´ ìº”ë²„ìŠ¤(2)ë³´ë‹¤ ë’¤ */
    opacity: 0;        /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ ìœ„í•´ */
    transition: opacity 0.5s ease-in-out;
    /* í•„í„°ëŠ” JSì—ì„œ ì ìš© */
}


/* ì›¹ìº  ì˜¤ë²„ë ˆì´ (ì´ì œ ì‚¬ìš© ì•ˆ í•¨) */
.webcam-overlay { display: none; }

/* íŒŒí‹°í´ ìº”ë²„ìŠ¤ */
#canvas { 
    display:block; 
    position:absolute; 
    top:0; 
    left:0; 
    background: transparent; 
    z-index: 2; /* íŒŒí‹°í´ ìº”ë²„ìŠ¤ */
}

.cursor-image {
    position: fixed;
    width: 120px;
    height: 120px;
    border-radius: 0;
    border: none;
    background: transparent;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: none;
    background-image: url('1.png'); /* 1.png íŒŒì¼ í•„ìš” */
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
}
.final-text { position:absolute; top:50%; left:50%; color:#0033ff; font-size:4rem; text-align:center; opacity:0; text-shadow: 0 0 15px #0033ff, 0 0 25px #0033ff, 0 0 35px rgba(0,51,255,0.3); transform: translate(-50%, -50%) scale(1); animation: breathe 5s ease-in-out infinite 5s, glow 3s ease-in-out infinite alternate; transition: opacity 6s ease-in; font-weight: normal; z-index: 20; line-height: 1.2; }
@keyframes breathe {
  0%, 100% { transform: translate(-50%, -50%) scale(1); text-shadow: 0 0 15px #0033ff; }
  50% { transform: translate(-50%, -50%) scale(1.03); text-shadow: 0 0 25px #0033ff; }
}
@keyframes glow {
  0% { text-shadow: 0 0 15px #0033ff, 0 0 25px #0033ff, 0 0 35px rgba(0,51,255,0.3); }
  100% { text-shadow: 0 0 20px #0033ff, 0 0 30px #0033ff, 0 0 40px rgba(0,51,255,0.5), 0 0 50px rgba(0,51,255,0.2); }
}

/* ì»¤ì„œ ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
@keyframes rotate {
  0% { transform: scale(1.4) rotate(0deg); }
  100% { transform: scale(1.4) rotate(360deg); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1.4); }
  50% { transform: scale(1.6); }
}

@keyframes shake {
  0%, 100% { transform: scale(1.5) translateX(0); }
  25% { transform: scale(1.5) translateX(-2px); }
  75% { transform: scale(1.5) translateX(2px); }
}

@keyframes float {
  0%, 100% { transform: scale(1.2) translateY(0); }
  50% { transform: scale(1.2) translateY(-3px); }
}

@keyframes bounce {
  0%, 100% { transform: scale(1.4) translateY(0); }
  50% { transform: scale(1.4) translateY(-5px); }
}

@keyframes wiggle {
  0%, 100% { transform: scale(1.5) rotate(0deg); }
  25% { transform: scale(1.5) rotate(-3deg); }
  75% { transform: scale(1.5) rotate(3deg); }
}

@keyframes fade {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}
.subtitle-container { 
    position: absolute; bottom: 8%; left: 50%; transform: translateX(-50%); 
    width: 85%; max-width: 900px; 
    background: #ffffff; 
    border-radius: 8px; 
    border: 1.5px solid #0033ff;
    box-shadow: none;
    padding: 20px 30px; 
    color: #0033ff; 
    font-size: 1.5rem; 
    text-align: center; 
    opacity: 0; 
    transition: all 0.8s ease-in-out; 
    pointer-events: none; 
    z-index: 15; 
    font-weight: 600;
    line-height: 1.4;
    text-shadow: none;
}
.cosmic-ui {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 5;
}
.dimension-indicator {
    position: absolute;
    top: 20px; left: 20px;
    background: #ffffff;
    border: 1.5px solid #0033ff;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: none;
}
/* ìƒë‹¨ ì œëª© ìŠ¤íƒ€ì¼ */
.main-title {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 100;
    color: #0033ff;
}

    .main-title h1 {
        font-family: 'Anton', sans-serif;
        font-size: 5.2rem;
        font-weight: 400;
        letter-spacing: 4px;
        line-height: 1;
        margin-bottom: 10px;
        color: #0033ff;
        text-transform: uppercase;
    }

.main-title p {
    font-size: 1.3rem;
    font-weight: 300;
    letter-spacing: 3px;
    opacity: 0.8;
    color: #0033ff;
}

/* í•˜ë‹¨ UI ìŠ¤íƒ€ì¼ */
.bottom-ui {
    position: fixed;
    bottom: 20px;
    left: 0;
    right: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 0 20px;
}

/* ì´¬ì˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.camera-button {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 200;
}

#captureBtn {
    background: linear-gradient(135deg, #0033ff, #0066ff);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 51, 255, 0.4);
    transition: all 0.3s ease;
    animation: pulse 2s ease-in-out infinite;
    display: flex;
    align-items: center;
    justify-content: center;
}

#captureBtn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(0, 51, 255, 0.6);
}

#captureBtn:active {
    transform: scale(0.95);
}

/* ì™¼ìª½ í•˜ë‹¨: ë‹¨ê³„ ì„¤ëª… */
.stage-description {
    background: rgba(255, 255, 255, 0.9);
    border: 1.5px solid #0033ff;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.stage-text {
    font-size: 1rem;
    font-weight: 600;
    color: #0033ff;
    letter-spacing: 1px;
}

/* ì˜¤ë¥¸ìª½ í•˜ë‹¨: ì§„í–‰ë„ ë°” */
.progress-container {
    background: rgba(255, 255, 255, 0.9);
    border: 1.5px solid #0033ff;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 12px;
}

.progress-bar {
    width: 150px;
    height: 20px;
    background: rgba(0, 51, 255, 0.2);
    border: 1.5px solid #0033ff;
    border-radius: 0;
    overflow: hidden;
    display: flex;
    gap: 2px;
    padding: 2px;
}

.progress-segment {
    flex: 1;
    height: 100%;
    background: rgba(0, 51, 255, 0.2);
    border: 1px solid rgba(0, 51, 255, 0.3);
    transition: background 0.3s ease;
}

.progress-segment.filled {
    background: #0033ff;
    border-color: #0033ff;
}

.progress-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: #0033ff;
    white-space: nowrap;
}

.subtitle-container.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
/* -------------------- CSS ì½”ë“œ ë -------------------- */
</style>
</head>
<body>

<div id="background-container">
    <video id="webcamVideo" autoplay playsinline muted loop></video> 
    <video id="backgroundVideo" muted loop playsinline></video> 
</div>

<canvas id="canvas"></canvas>

<div class="final-text" id="finalText">You are everything, everywhere, all at once.</div>
<div class="cursor-image" id="cursorImage"></div>
<div class="subtitle-container" id="subtitleContainer">
    <p id="subtitleText"></p>
</div>

<div class="main-title">
    <h1>EVERYTHING EVERYWHERE ALL AT ONCE</h1>
    <p>An Interactive Multiverse Experience</p>
</div>

<div class="bottom-ui">
    <div class="stage-description" id="stageDescription">
        <span class="stage-text">CHOOSING DIMENSION</span>
    </div>
    
    <div class="progress-container">
        <div class="progress-bar" id="progressBar">
            <div class="progress-segment" id="segment1"></div>
            <div class="progress-segment" id="segment2"></div>
            <div class="progress-segment" id="segment3"></div>
        </div>
        <div class="progress-text" id="progressText">0/3</div>
    </div>
</div>

<!-- ì´¬ì˜ ë²„íŠ¼ (ì„¹ì…˜ 6ì—ì„œë§Œ í‘œì‹œ) -->
<div class="camera-button" id="cameraButton" style="display: none;">
    <button id="captureBtn">ğŸ“¸</button>
</div>
<script>
// -------------------- ì„¤ì • --------------------
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const cursorImage = document.getElementById('cursorImage');
const webcamVideo = document.getElementById('webcamVideo'); // ì›¹ìº  ë¹„ë””ì˜¤ (ì´ì œ ì‚¬ìš© ì•ˆ í•¨)
const backgroundVideo = document.getElementById('backgroundVideo'); // ë°°ê²½ ë™ì˜ìƒ ìš”ì†Œ

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const width = canvas.width;
const height = canvas.height;
const centerX = width / 2;
const centerY = height / 2;

let mouse = {x: centerX, y: centerY, down:false, hoverTarget: null};
window.addEventListener('mousemove', e => { 
    mouse.x = e.clientX; 
    mouse.y = e.clientY; 
    cursorImage.style.left = (e.clientX - 60) + 'px';
    cursorImage.style.top = (e.clientY - 60) + 'px';
    cursorImage.style.opacity = '1';
    cursorImage.style.backgroundImage = "url('1.png')";
    // borderRadiusëŠ” ì°¨ì› ì²´í—˜ ì¤‘ì—ëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŒ
});
window.addEventListener('mousedown', (e)=>{
    mouse.down = true;
    if (section === 0 && mouse.hoverTarget) {
        mouse.hoverTarget.isSelected = true;
        particles.forEach(p => { if (!p.isSelected) p.shatter(); });
        advanceSection();
    } else if (section === 3) {
        // í…ìŠ¤íŠ¸ íŒŒí‹°í´ í´ë¦­ í™•ì¸
        if (mouse.hoverTarget && mouse.hoverTarget.text) {
            // startExperience í•¨ìˆ˜ í˜¸ì¶œ
            startExperience(mouse.hoverTarget.text);
            mouse.hoverTarget = null;
        } else {
             playGlitchSound(); // ë°°ê²½ í´ë¦­ ì‹œ ê¸€ë¦¬ì¹˜ ì‚¬ìš´ë“œ
        }
    } else if (section === 4 && isAwaitingFinalClick) {
        initiateFinalCollapse();
    }
});
window.addEventListener('mouseup', ()=>{
    mouse.down = false;
    if (section === 3) {
        glitchEffect.type = 'none';
    }
    stopGlitchSound();
});
window.addEventListener('mouseleave', () => { cursorImage.style.opacity = '0'; });
window.addEventListener('mouseenter', () => { cursorImage.style.opacity = '1'; });

let section = 0; // 0:ì„ íƒ, 1:ë‹¤ì´ë¹™, 2:íŒŒí¸í™”, 3:í˜¼ëˆ, 4:ìˆ˜ë ´, 5:í´ë¼ì´ë§¥ìŠ¤, 6:í”¼ë‚ ë ˆ
const sectionDurations = { 1: 4000, 2: 2500, 3: 25000 };
let particles = [], embers = [], shockwaves = [], glowParticles = [];
let flashRadius = 0, flashAlpha = 1, screenShake = {x:0, y:0, intensity:0};
let selectedBaseColor = null;
let glitchEffect = { type: 'none', duration: 0 };
let isAwaitingFinalClick = false;
let convergenceStartTime = 0;
let isCollapsing = false; // ë¶•ê´´ ì• ë‹ˆë©”ì´ì…˜ í”Œë˜ê·¸
let experienceCount = 0; // ì²´í—˜ íšŸìˆ˜ ì¶”ì 
let sectionStartTime = 0; // ì„¹ì…˜ ì‹œì‘ ì‹œê°„ ì¶”ì 

const segment1 = document.getElementById('segment1');
const segment2 = document.getElementById('segment2');
const segment3 = document.getElementById('segment3');
const progressText = document.getElementById('progressText');
const stageText = document.querySelector('.stage-text');
const cameraButton = document.getElementById('cameraButton');
const captureBtn = document.getElementById('captureBtn');

// ì›¹ìº  ê´€ë ¨ ë³€ìˆ˜
let webcamStream = null;
let webcamPermissionGranted = false;

// ì´¬ì˜ ê¸°ëŠ¥ - í™”ë©´ ì „ì²´ ìŠ¤í¬ë¦°ìƒ·
function capturePhoto() {
    if (!webcamStream) {
        alert('ì›¹ìº ì´ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // í™”ë©´ ì „ì²´ í¬ê¸°ë¡œ ìº”ë²„ìŠ¤ ìƒì„±
    const captureCanvas = document.createElement('canvas');
    const captureCtx = captureCanvas.getContext('2d');
    
    // í™”ë©´ ì „ì²´ í¬ê¸° ì„¤ì •
    captureCanvas.width = window.innerWidth;
    captureCanvas.height = window.innerHeight;
    
    // ë°°ê²½ì„ ê²€ì€ìƒ‰ìœ¼ë¡œ ì±„ìš°ê¸°
    captureCtx.fillStyle = '#000000';
    captureCtx.fillRect(0, 0, captureCanvas.width, captureCanvas.height);
    
    // ì›¹ìº  ë¹„ë””ì˜¤ë¥¼ í™”ë©´ ì „ì²´ì— ë§ì¶° ê·¸ë¦¬ê¸°
    captureCtx.drawImage(webcamVideo, 0, 0, captureCanvas.width, captureCanvas.height);
    
    // ë°ê¸°ì™€ ë¸”ëŸ¬ íš¨ê³¼ë¥¼ ìœ„í•œ ìº”ë²„ìŠ¤ í•„í„° ì ìš©
    captureCtx.filter = 'brightness(1.3) blur(2px)';
    captureCtx.drawImage(webcamVideo, 0, 0, captureCanvas.width, captureCanvas.height);
    
    // í•„í„° ë¦¬ì…‹
    captureCtx.filter = 'none';
    
    // í‘ë°± í•„í„° ì ìš©
    const imageData = captureCtx.getImageData(0, 0, captureCanvas.width, captureCanvas.height);
    const data = imageData.data;
    
    for (let i = 0; i < data.length; i += 4) {
        // RGB ê°’ì„ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜
        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
        data[i] = gray;     // Red
        data[i + 1] = gray; // Green
        data[i + 2] = gray; // Blue
        // AlphaëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
    }
    
    captureCtx.putImageData(imageData, 0, 0);
    
    // ìµœì¢… í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° (í™”ë©´ ì¤‘ì•™ì—) - ì¡°ì„ êµ´ë¦¼ì²´ ì ìš©
    const finalText = document.getElementById('finalText');
    if (finalText && finalText.style.opacity === '1') {
        captureCtx.save();
        captureCtx.font = '4rem JoseonGulim, serif';
        captureCtx.fillStyle = '#0033ff';
        captureCtx.textAlign = 'center';
        captureCtx.textBaseline = 'middle';
        captureCtx.shadowColor = '#0033ff';
        captureCtx.shadowBlur = 15;
        
        const textX = captureCanvas.width / 2;
        const textY = captureCanvas.height / 2;
        captureCtx.fillText('You are everything, everywhere, all at once.', textX, textY);
        captureCtx.restore();
    }
    
    // ì´¬ì˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ì´¬ì˜ ì‹œì—ëŠ” ë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šë„ë¡)
    const originalDisplay = cameraButton.style.display;
    cameraButton.style.display = 'none';
    
    // ì ì‹œ í›„ ë‹¤ì‹œ í‘œì‹œ
    setTimeout(() => {
        cameraButton.style.display = originalDisplay;
    }, 100);
    
    // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
    captureCanvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `multiverse-screenshot-${new Date().getTime()}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // ì´¬ì˜ ì™„ë£Œ ë©”ì‹œì§€
        showSubtitle('ğŸ“¸ í™”ë©´ ì „ì²´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        setTimeout(() => {
            showSubtitle('ë‹¹ì‹ ì€ ëª¨ë“  ì°¨ì›ì„ ê²½í—˜í–ˆìŠµë‹ˆë‹¤.');
        }, 3000);
    }, 'image/png');
}

// ì´¬ì˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
captureBtn.addEventListener('click', capturePhoto);

const memoryQuotes = [ 
    "ìˆ˜ë§ì€ ì„ íƒì§€ ì¤‘ ìµœì•…ì˜ ê²°ê³¼ë§Œ ëª¨ì¸ ìš°ì£¼ê°€ ë°”ë¡œ ì—¬ê¸°ì•¼.", "ì¹œì ˆì€, ìš°ë¦¬ê°€ í˜¼ë€ ì†ì—ì„œ ê¸¸ì„ ìƒì—ˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì „ëµì ì´ê³  ê°•ë ¥í•œ ë¬´ê¸°ë‹¤.", "ëª¨ë“  ìƒˆë¡œìš´ ë°œê²¬ì€ ê·¸ì € ëˆ„êµ°ê°€ì˜ ê¸°ì–µì¼ ë¿ì´ì•¼.", "ì•„ë¬´ê²ƒë„ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤ë©´, ìš°ë¦¬ê°€ í•¨ê»˜ ê²ªëŠ” ëª¨ë“  ê³ í†µê³¼ ê¸°ì¨ë„ ì¤‘ìš”í•˜ì§€ ì•Šì€ ê±°ê² ì§€.", "ë‹¹ì‹ ì€ ëª¨ë“  ìš°ì£¼ì—ì„œ ê°€ì¥ ê°•ë ¥í•œ ì¡´ì¬ì•¼.", "ì‚¬ë‘ì€ ìš°ë¦¬ê°€ ì„ íƒí•˜ëŠ” ê²ƒì´ë‹¤. ì•„ë¬´ë¦¬ ì‘ì€ ê²ƒì´ë¼ë„.", "ìš°ë¦¬ëŠ” ëª¨ë‘ ì—°ê²°ë˜ì–´ ìˆì–´. ëª¨ë“  ì°¨ì›ì—ì„œ.", "ê°€ì¥ ì–´ë‘ìš´ ìˆœê°„ì—ë„ ë¹›ì´ ìˆì–´. ë‹¹ì‹  ì•ˆì—.", "ë¬´í•œí•œ ê°€ëŠ¥ì„± ì†ì—ì„œë„ ë‹¹ì‹ ì€ ìœ ì¼ë¬´ì´í•´.", "ëª¨ë“  ê²ƒì´ ë™ì‹œì— ì¼ì–´ë‚˜ê³  ìˆì–´. ì§€ê¸ˆ ì´ ìˆœê°„ì—ë„.", "ë‹¹ì‹ ì€ ì´ë¯¸ ì™„ë²½í•´. ëª¨ë“  ë²„ì „ì˜ ë‹¹ì‹ ì´.", "ê°€ì¥ ì‘ì€ í–‰ë™ì´ ê°€ì¥ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ë‚´.", "ìš°ë¦¬ëŠ” ëª¨ë‘ ê°™ì€ ì¡´ì¬ì•¼. ë‹¤ë¥¸ ì°¨ì›ì—ì„œë§Œ.", "ì‚¬ë‘ì€ ëª¨ë“  ì°¨ì›ì„ í†µê³¼í•˜ëŠ” ìœ ì¼í•œ í˜ì´ì•¼.", "ë‹¹ì‹ ì˜ ì„ íƒì´ ëª¨ë“  ìš°ì£¼ë¥¼ êµ¬ì›í•  ìˆ˜ ìˆì–´.", "ë¬´í•œí•œ ê°€ëŠ¥ì„± ì†ì—ì„œë„ ë‹¹ì‹ ì€ íŠ¹ë³„í•´.", "ëª¨ë“  ê²ƒì´ ì—°ê²°ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì„ ê¸°ì–µí•´.", "ê°€ì¥ ì–´ë ¤ìš´ ìˆœê°„ì´ ê°€ì¥ ì¤‘ìš”í•œ ìˆœê°„ì´ì•¼.", "ë‹¹ì‹ ì€ ì´ë¯¸ ëª¨ë“  ê²ƒì„ ì•Œê³  ìˆì–´.", "ì‚¬ë‘ì´ ëª¨ë“  ë‹µì´ì•¼. ëª¨ë“  ì°¨ì›ì—ì„œ."
];

// ë² ì´ê¸€ ëŒ€ì‚¬ ìŠ¤íƒ€ì¼ì˜ ìµœì¢… ë©”ì‹œì§€ë“¤
const finalBagelQuotes = [
    "ëª¨ë“  ê²ƒì´ ë™ì‹œì— ì¼ì–´ë‚˜ê³  ìˆì–´. ì§€ê¸ˆ ì´ ìˆœê°„ì—ë„.",
    "ë‹¹ì‹ ì€ ì´ë¯¸ ì™„ë²½í•´. ëª¨ë“  ë²„ì „ì˜ ë‹¹ì‹ ì´.",
    "ë¬´í•œí•œ ê°€ëŠ¥ì„± ì†ì—ì„œë„ ë‹¹ì‹ ì€ íŠ¹ë³„í•´.",
    "ëª¨ë“  ê°€ëŠ¥ì„±ë³´ë‹¤ ì¤‘ìš”í•œ ê²ƒì€ 'ì§€ê¸ˆ, ì—¬ê¸°'ì˜ ë‹¹ì‹ ì…ë‹ˆë‹¤."
];


const colorPalette = [ 
    // ë„¤ì˜¨ ì»¬ëŸ¬
    {r: 255, g: 0, b: 150}, {r: 0, g: 255, b: 255}, {r: 255, g: 255, b: 0}, {r: 255, g: 0, b: 255}, 
    {r: 0, g: 255, b: 0}, {r: 255, g: 100, b: 0}, {r: 150, g: 0, b: 255}, {r: 255, g: 255, b: 255}, 
    {r: 0, g: 200, b: 255}, {r: 255, g: 200, b: 0},
    
    // íŒŒìŠ¤í…” ì»¬ëŸ¬
    {r: 255, g: 182, b: 193}, {r: 173, g: 216, b: 230}, {r: 255, g: 218, b: 185}, {r: 221, g: 160, b: 221},
    {r: 255, g: 228, b: 196}, {r: 240, g: 248, b: 255}, {r: 255, g: 239, b: 213}, {r: 230, g: 230, b: 250},
    
    // ì–´ë‘ìš´ ì»¬ëŸ¬
    {r: 139, g: 69, b: 19}, {r: 75, g: 0, b: 130}, {r: 0, g: 100, b: 0}, {r: 128, g: 0, b: 128},
    {r: 25, g: 25, b: 112}, {r: 47, g: 79, b: 79}, {r: 105, g: 105, b: 105}, {r: 169, g: 169, b: 169},
    
    // ë”°ëœ»í•œ ì»¬ëŸ¬
    {r: 255, g: 69, b: 0}, {r: 255, g: 140, b: 0}, {r: 255, g: 215, b: 0}, {r: 255, g: 20, b: 147},
    {r: 255, g: 105, b: 180}, {r: 255, g: 192, b: 203}, {r: 255, g: 160, b: 122}, {r: 255, g: 127, b: 80},
    
    // ì°¨ê°€ìš´ ì»¬ëŸ¬
    {r: 0, g: 191, b: 255}, {r: 30, g: 144, b: 255}, {r: 0, g: 206, b: 209}, {r: 72, g: 209, b: 204},
    {r: 0, g: 250, b: 154}, {r: 50, g: 205, b: 50}, {r: 124, g: 252, b: 0}, {r: 173, g: 255, b: 47},
    
    // ë©”íƒˆë¦­ ì»¬ëŸ¬
    {r: 192, g: 192, b: 192}, {r: 255, g: 215, b: 0}, {r: 184, g: 134, b: 11}, {r: 218, g: 165, b: 32},
    {r: 205, g: 127, b: 50}, {r: 160, g: 82, b: 45}, {r: 139, g: 69, b: 19}, {r: 101, g: 67, b: 33},
    
    // íŠ¹ìˆ˜ ì»¬ëŸ¬
    {r: 255, g: 0, b: 0}, {r: 0, g: 0, b: 255}, {r: 0, g: 128, b: 0}, {r: 128, g: 0, b: 128},
    {r: 255, g: 165, b: 0}, {r: 0, g: 255, b: 127}, {r: 255, g: 0, b: 255}, {r: 0, g: 255, b: 255}
];
function getRandomColor() { const color = colorPalette[Math.floor(Math.random() * colorPalette.length)]; return `rgb(${color.r}, ${color.g}, ${color.b})`; }
function getShadedColor(baseRgb, minBrightness = 0.3, maxBrightness = 1.0) { let [r, g, b] = baseRgb.match(/\d+/g).map(Number); let cmin = Math.min(r,g,b), cmax = Math.max(r,g,b), delta = cmax - cmin, h = 0, s = 0, l = 0; if (delta == 0) h = 0; else if (cmax == r) h = ((g - b) / delta) % 6; else if (cmax == g) h = (b - r) / delta + 2; else h = (r - g) / delta + 4; h = Math.round(h * 60); if (h < 0) h += 360; l = (cmax + cmin) / 2; s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l / 255 - 1)); l = (Math.random() * (maxBrightness - minBrightness) + minBrightness) * 100; s /= 100; l /= 100; let c = (1 - Math.abs(2 * l - 1)) * s, x = c * (1 - Math.abs((h / 60) % 2 - 1)), m = l - c / 2, r2 = 0, g2 = 0, b2 = 0; if (0 <= h && h < 60) { r2 = c; g2 = x; b2 = 0; } else if (60 <= h && h < 120) { r2 = x; g2 = c; b2 = 0; } else if (120 <= h && h < 180) { r2 = 0; g2 = c; b2 = x; } else if (180 <= h && h < 240) { r2 = 0; g2 = x; b2 = c; } else if (240 <= h && h < 300) { r2 = x; g2 = 0; b2 = c; } else if (300 <= h && h < 360) { r2 = c; g2 = 0; b2 = x; } r = Math.round((r2 + m) * 255); g = Math.round((g2 + m) * 255); b = Math.round((b2 + m) * 255); return `rgb(${r}, ${g}, ${b})`; }

// -------------------- í´ë˜ìŠ¤ --------------------
class Particle {
    constructor(x, y, r, color, text = ""){
        this.x = x; 
        this.y = y; 
        this.r = r; 
        this.color = color; 
        this.dx = (Math.random()-0.5)*1.2; // ì†ë„ ì¡°ì • (2.5 -> 1.2)
        this.dy = (Math.random()-0.5)*1.2; // ì†ë„ ì¡°ì • (2.5 -> 1.2)
        this.text = text; 
        this.fontSize = 28; // í…ìŠ¤íŠ¸ í¬ê¸° ì¦ê°€ (24 -> 28) 
        this.alpha = 1; 
        this.isChoiceParticle = false; 
        this.isSelected = false; 
        this.isShattered = false;
        // ì¶”ê°€ì ì¸ ì›€ì§ì„ì„ ìœ„í•œ ë³€ìˆ˜ë“¤
        this.baseDx = this.dx;
        this.baseDy = this.dy;
        this.waveOffset = Math.random() * Math.PI * 2;
        this.baseHue = Math.random() * 360; // ê° íŒŒí‹°í´ë§ˆë‹¤ ê³ ìœ í•œ ìƒ‰ìƒ
    }
    shatter() { this.isShattered = true; this.dx = (Math.random() - 0.5) * 15; this.dy = (Math.random() - 0.5) * 15; if (Math.random() < 0.3) playFallingSound(); }
    update(){
        // íŒŒí‹°í´ì— ë” ì—­ë™ì ì¸ ì›€ì§ì„ ì¶”ê°€ (ê°•ë„ ì¡°ì •)
        const time = Date.now() * 0.001;
        const waveX = Math.sin(time * 0.3 + this.waveOffset) * 0.15; // ê°•ë„ ê°ì†Œ (0.5 -> 0.3, 0.3 -> 0.15)
        const waveY = Math.cos(time * 0.2 + this.waveOffset) * 0.15; // ê°•ë„ ê°ì†Œ (0.3 -> 0.2, 0.3 -> 0.15)
        
        if (section === 0 && this.isShattered) { 
            this.x += this.dx; this.y += this.dy; this.alpha -= 0.02; this.dx *= 0.98; this.dy *= 0.98; 
        } else if (section === 1) { 
            if (this.isSelected) { 
                this.dx += (centerX - this.x) * 0.01; this.dy += (centerY - this.y) * 0.01; this.r += 25; 
                if(Math.random() < 0.2) shockwaves.push(new Shockwave(this.x, this.y, this.r, this.color)); 
            } else { 
                this.alpha -= 0.05; 
            } 
        } else if (section === 3) {
            // ì„¹ì…˜ 3: íŒŒë„ íš¨ê³¼ë§Œ ì ìš©, ì†ë„ ì¦ê°€ ì œê±°
            this.dx += waveX * 0.05; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.1 -> 0.05)
            this.dy += waveY * 0.05; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.1 -> 0.05)
            this.x += this.dx; // ì†ë„ ì¦ê°€ ì œê±°
            this.y += this.dy; // ì†ë„ ì¦ê°€ ì œê±° 
            if(glitchEffect.type === 'gravity') { this.dy += 0.1; } 
            if((this.x < this.r && this.dx < 0) || (this.x > width - this.r && this.dx > 0)) this.dx *= -0.8; 
            if((this.y < this.r && this.dy < 0) || (this.y > height - this.r && this.dy > 0)) this.dy *= -0.8; 
        } else { 
            // ê¸°ë³¸ ì›€ì§ì„ì— íŒŒë„ íš¨ê³¼ ì¶”ê°€ (ê°•ë„ ê°ì†Œ)
            this.dx += waveX * 0.02; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.05 -> 0.02)
            this.dy += waveY * 0.02; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.05 -> 0.02)
            this.x += this.dx; this.y += this.dy;
            if(glitchEffect.type === 'gravity') { this.dy += 0.1; }
            if((this.x < this.r && this.dx < 0) || (this.x > width - this.r && this.dx > 0)) this.dx *= -0.8; 
            if((this.y < this.r && this.dy < 0) || (this.y > height - this.r && this.dy > 0)) this.dy *= -0.8; 
        }
        if(section === 4){
            const vecX = centerX - this.x; const vecY = centerY - this.y; const dist = Math.sqrt(vecX*vecX + vecY*vecY);
            const pullForce = 0.001 * (1 - dist / width); this.dx += vecX * pullForce; this.dy += vecY * pullForce;
            const orbitSpeed = 0.05; this.dx += -vecY * orbitSpeed / Math.max(dist, 1); this.dy += vecX * orbitSpeed / Math.max(dist, 1); 
            this.dx *= 0.99; this.dy *= 0.99; if (dist < 20) this.r -= 0.2; 
        } 
    }
     draw(ctx){ 
         if(this.r <= 0.1 || this.alpha <= 0) return; 
         ctx.save(); 
         ctx.globalAlpha = this.alpha; 
         
         // í…ìŠ¤íŠ¸ íŒŒí‹°í´ê³¼ ì¡°ê°ë‚œ í˜„ì‹¤ íŒŒí‹°í´ì„ êµ¬ë¶„í•˜ì—¬ ë Œë”ë§
        if (this.text) {
            // í…ìŠ¤íŠ¸ íŒŒí‹°í´: ì›í˜• ë Œë”ë§ ì œê±°, í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ
            // ì›í˜• ë Œë”ë§ ì½”ë“œ ì™„ì „ ì œê±°ë¨
        } else {
             // ì¡°ê°ë‚œ í˜„ì‹¤ íŒŒí‹°í´: ì„¹ì…˜ 2ì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼
             const glowIntensity = this.isChoiceParticle && this === mouse.hoverTarget ? 30 : section === 1 && this.isSelected ? 20 : 10;
             ctx.shadowColor = this.color;
             ctx.shadowBlur = glowIntensity;
             ctx.fillStyle = this.color;
             ctx.beginPath();
             ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
             ctx.fill();
             
             if (this.isChoiceParticle && this === mouse.hoverTarget) {
                 ctx.shadowBlur = glowIntensity * 1.2;
                 ctx.globalAlpha = this.alpha * 0.2;
                 ctx.beginPath();
                 ctx.arc(this.x, this.y, this.r * 1.3, 0, Math.PI*2);
                 ctx.fill();
             }
         }
         
         ctx.restore(); 
         
         // í…ìŠ¤íŠ¸ ë Œë”ë§ (í…ìŠ¤íŠ¸ íŒŒí‹°í´ë§Œ)
         if(this.text && !this.isChoiceParticle){ 
             ctx.save(); 
             ctx.fillStyle = `rgba(255,255,255,${0.9 * this.alpha})`; 
            ctx.font = `${this.fontSize}px 'JoseonGulim'`; 
            ctx.textAlign = 'center'; 
            ctx.textBaseline = 'middle'; 
            
            // ê° íŒŒí‹°í´ë§ˆë‹¤ ê³ ìœ í•œ ì•Œë¡ë‹¬ë¡í•œ ìƒ‰ìƒ
            const time = Date.now() * 0.003;
            const hue = (this.baseHue + time * 20) % 360; // ê° íŒŒí‹°í´ì˜ ê³ ìœ  ìƒ‰ìƒì— ì‹œê°„ ë³€í™” ì¶”ê°€
            const textColor = `hsl(${hue}, 90%, 60%)`; // í…ìŠ¤íŠ¸ ìì²´ë¥¼ ë¬´ì§€ê°œìƒ‰ìœ¼ë¡œ
            const glowColor = `hsl(${hue}, 80%, 70%)`; // ê¸€ë¡œìš°ë„ ê°™ì€ ìƒ‰ìƒ
            
            ctx.shadowColor = glowColor; 
            ctx.shadowBlur = 15 + Math.sin(time + this.x * 0.01) * 5; // ë™ì ì¸ ê¸€ë¡œìš°
            ctx.fillStyle = textColor; // ì•Œë¡ë‹¬ë¡í•œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ
            ctx.fillText(this.text, this.x, this.y);
             ctx.restore(); 
         } 
     }
}
class Shockwave { 
    constructor(x, y, r, color) { this.x = x; this.y = y; this.r = r; this.color = color; this.life = 1; } 
    update() { this.r += 8; this.life -= 0.02; } 
    draw(ctx) { if (this.life <= 0) return; ctx.save(); ctx.strokeStyle = this.color; ctx.globalAlpha = this.life; ctx.lineWidth = 5; ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.stroke(); ctx.restore(); } 
}
class Ember { 
    constructor(){ const angle = Math.random() * Math.PI * 2; const speed = Math.random() * 1.5; this.x = centerX; this.y = centerY; this.dx = Math.cos(angle) * speed; this.dy = Math.sin(angle) * speed; this.r = Math.random() * 2.5; this.life = 1; this.color = getRandomColor(); this.glowIntensity = Math.random() * 15 + 5; } 
    update(){ this.x += this.dx; this.y += this.dy; this.life -= 0.003; this.glowIntensity += Math.sin(Date.now() * 0.01) * 1; } 
    draw(ctx){ if(this.life <= 0) return; ctx.save(); ctx.shadowColor = this.color; ctx.shadowBlur = this.glowIntensity; ctx.fillStyle = `rgba(${parseInt(this.color.substring(4))}, ${parseInt(this.color.substring(this.color.indexOf(',')+1))}, ${parseInt(this.color.substring(this.color.lastIndexOf(',')+1))}, ${this.life})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.fill(); ctx.restore(); } 
}
class GlowParticle { 
    constructor(x, y) { 
        this.x = x; 
        this.y = y; 
        this.r = Math.random() * 3 + 1; 
        this.dx = (Math.random() - 0.5) * 1.5; // ì†ë„ ì¡°ì • (3 -> 1.5)
        this.dy = (Math.random() - 0.5) * 1.5; // ì†ë„ ì¡°ì • (3 -> 1.5)
        this.color = getRandomColor(); 
        this.life = 1; 
        this.pulse = 0;
        this.waveOffset = Math.random() * Math.PI * 2;
    } 
    update() { 
        // íŒŒë„ íš¨ê³¼ ì¶”ê°€
        const time = Date.now() * 0.001;
        const waveX = Math.sin(time * 0.4 + this.waveOffset) * 0.2;
        const waveY = Math.cos(time * 0.6 + this.waveOffset) * 0.2;
        
        this.dx += waveX * 0.03; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.1 -> 0.03)
        this.dy += waveY * 0.03; // íŒŒë„ íš¨ê³¼ ê°ì†Œ (0.1 -> 0.03)
        this.x += this.dx; 
        this.y += this.dy; 
        this.life -= 0.01; 
        this.pulse += 0.1; 
        this.dx *= 0.98; // ë§ˆì°° ê°ì†Œ (0.99 -> 0.98)
        this.dy *= 0.98; // ë§ˆì°° ê°ì†Œ (0.99 -> 0.98)
    } 
    draw(ctx) { if (this.life <= 0) return; ctx.save(); const pulseSize = this.r + Math.sin(this.pulse) * 1; ctx.shadowColor = this.color; ctx.shadowBlur = 15 + Math.sin(this.pulse) * 5; ctx.globalAlpha = this.life; ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, pulseSize, 0, Math.PI*2); ctx.fill(); ctx.restore(); } 
}


// -------------------- UI ë° ìë§‰ --------------------
const phrases = [
    "ì œë¹µì‚¬", "ì—„ë§ˆ", "ì¿µí‘¸ ë§ˆìŠ¤í„°", "ê³¼í•™ì", "ê¸¸ê°€ì˜ ëŒë©©ì´", "ê°€ìˆ˜", "ë”¸", "ì†Œì„¸ì§€ ì†ê°€ë½", "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ"
];

const subtitleContainer = document.getElementById('subtitleContainer');
const subtitleText = document.getElementById('subtitleText');
let subtitleTimeout;
function showSubtitle(message) { 
    clearTimeout(subtitleTimeout); 
    subtitleText.textContent = message; 
    subtitleContainer.classList.add('show'); 
    subtitleTimeout = setTimeout(() => { 
        subtitleContainer.classList.remove('show'); 
    }, 8000); 
}

function updateProgress() {
    // ì„¹ì…˜ë³„ ì§„í–‰ë„ ê³„ì‚° (0-6 ì„¹ì…˜ì„ 3ì¹¸ìœ¼ë¡œ ë‚˜ëˆ”)
    const progress = Math.min(experienceCount, 3); // ìµœëŒ€ 3ê°œ ì²´í—˜
    
    // ê° ì¹¸ì˜ ì±„ì›€ ìƒíƒœ ì—…ë°ì´íŠ¸
    segment1.classList.toggle('filled', progress >= 1);
    segment2.classList.toggle('filled', progress >= 2);
    segment3.classList.toggle('filled', progress >= 3);
    
    // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    progressText.textContent = `${progress}/3`;
}

function updateStage() {
    const stageNames = [
        'CHOOSING DIMENSION',
        'DIVING INTO REALITY', 
        'FRAGMENTING SPACE-TIME',
        'CHAOS REIGNING',
        'CONVERGING UNIVERSES',
        'CLIMAX APPROACHING',
        'UNITY ACHIEVED'
    ];
    stageText.textContent = stageNames[section] || 'MULTIVERSE ACTIVE';
}
const sectionMessages = { 0: "ë¬´í•œí•œ ìš°ì£¼ì—ì„œ ë‹¹ì‹ ì˜ ì •ì²´ì„±ì„ ì„ íƒí•˜ì„¸ìš”. ëª¨ë“  ê°€ëŠ¥ì„±ì´ ì—¬ê¸°ì— ìˆìŠµë‹ˆë‹¤.", 1: "ì„ íƒí•œ ì°¨ì›ìœ¼ë¡œì˜ ì—¬í–‰ì´ ì‹œì‘ë©ë‹ˆë‹¤...", 2: "ë‹¹ì‹ ì˜ ì„ íƒì´ ë§Œë“¤ì–´ë‚¸ í˜„ì‹¤. ëª¨ë“  ê²ƒì´ ì¡°ê°ë‚˜ê³  í©ì–´ì§‘ë‹ˆë‹¤.", 3: "ë©€í‹°ë²„ìŠ¤ì—ì„  í˜„ì‹¤ê³¼ ë‹¤ë¥¸ ì°¨ì›ì˜ ì‚¶ì´ ê³µì¡´í•©ë‹ˆë‹¤. ë¹›ë‚˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì„¸ìš”.", 4: "ëª¨ë“  ì°¨ì›ì´ ì†Œìš©ëŒì´ì¹©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...", 5: "í†µí•©ì˜ ìˆœê°„, ëª¨ë“  ê²½ê³„ê°€ ì‚¬ë¼ì§€ê³  ë³¸ì§ˆì´ ë“œëŸ¬ë‚©ë‹ˆë‹¤.", 6: "ë‹¹ì‹ ì€ ëª¨ë“  ê²ƒì´ë©°, ì–´ë””ì—ë‚˜ ì¡´ì¬í•˜ë©°, ì–¸ì œë‚˜ í•¨ê»˜í•©ë‹ˆë‹¤. ì˜¨ì „í•œ ë‹¹ì‹ ." };

// ì›¹ìº  ì‹œì‘ í•¨ìˆ˜
async function startWebcam() {
    if (webcamStream) return true; // ì´ë¯¸ ìŠ¤íŠ¸ë¦¼ì´ ìˆìœ¼ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
    try {
        console.log('ì›¹ìº  ì‹œì‘ ì‹œë„...');
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: 'user'
            } 
        }); 
        webcamStream = stream;
        webcamVideo.srcObject = stream; 
        await webcamVideo.play(); 
        webcamPermissionGranted = true;
        console.log('ì›¹ìº  ì„±ê³µì ìœ¼ë¡œ ì‹œì‘ë¨');
        return true;
    } catch (err) { 
        console.error('ì›¹ìº  ì‹œì‘ ì‹¤íŒ¨:', err);
        webcamPermissionGranted = false;
        return false;
    } 
}

// í…ìŠ¤íŠ¸ í´ë¦­ ì‹œ ë™ì˜ìƒ ë°°ê²½ ë° ìë§‰ í‘œì‹œ í•¨ìˆ˜
function startExperience(text) {
    console.log(`ë™ì˜ìƒ ì²´í—˜ ì‹œì‘: ${text}`);

    // í˜„ì¬ ì²´í—˜ ì¤‘ì¸ ì°¨ì›ì„ ì™¼ìª½ ë°”ì— í‘œì‹œ
    stageText.textContent = `EXPERIENCING: ${text}`;

    // ê° ì°¨ì›ì— ë§ëŠ” í™”ë ¤í•œ ì»¤ì„œ íš¨ê³¼ ì ìš©
    const cursorEffects = {
        "ì œë¹µì‚¬": {
            background: "conic-gradient(from 0deg, #ff6b35, #f7931e, #ffd23f, #ff6b35)",
            borderRadius: "50%",
            boxShadow: "0 0 40px rgba(255, 107, 53, 1), 0 0 80px rgba(255, 107, 53, 0.8), 0 0 120px rgba(255, 107, 53, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.3)",
            transform: "scale(1.4)",
            animation: "rotate 2s linear infinite"
        },
        "ì—„ë§ˆ": {
            background: "radial-gradient(circle, #ff69b4 0%, #ff1493 30%, #ffc0cb 70%, #ff69b4 100%)",
            borderRadius: "50%",
            boxShadow: "0 0 40px rgba(255, 105, 180, 1), 0 0 80px rgba(255, 105, 180, 0.8), 0 0 120px rgba(255, 105, 180, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.4)",
            transform: "scale(1.4)",
            animation: "pulse 1.5s ease-in-out infinite"
        },
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": {
            background: "linear-gradient(45deg, #ff0000, #ff4500, #ffa500, #ff0000)",
            borderRadius: "50%",
            boxShadow: "0 0 50px rgba(255, 0, 0, 1), 0 0 100px rgba(255, 0, 0, 0.8), 0 0 150px rgba(255, 0, 0, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.2)",
            transform: "scale(1.5)",
            animation: "shake 0.5s ease-in-out infinite"
        },
        "ê³¼í•™ì": {
            background: "conic-gradient(from 180deg, #00bfff, #1e90ff, #87ceeb, #00bfff)",
            borderRadius: "50%",
            boxShadow: "0 0 40px rgba(0, 191, 255, 1), 0 0 80px rgba(0, 191, 255, 0.8), 0 0 120px rgba(0, 191, 255, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.3)",
            transform: "scale(1.4)",
            animation: "rotate 3s linear infinite"
        },
        "ê¸¸ê°€ì˜ ëŒë©©ì´": {
            background: "radial-gradient(circle, #696969 0%, #808080 50%, #a9a9a9 100%)",
            borderRadius: "50%",
            boxShadow: "0 0 30px rgba(105, 105, 105, 1), 0 0 60px rgba(105, 105, 105, 0.8), 0 0 90px rgba(105, 105, 105, 0.6)",
            transform: "scale(1.2)",
            animation: "float 3s ease-in-out infinite"
        },
        "ê°€ìˆ˜": {
            background: "conic-gradient(from 90deg, #9370db, #8a2be2, #da70d6, #9370db)",
            borderRadius: "50%",
            boxShadow: "0 0 40px rgba(147, 112, 219, 1), 0 0 80px rgba(147, 112, 219, 0.8), 0 0 120px rgba(147, 112, 219, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.3)",
            transform: "scale(1.4)",
            animation: "rotate 2.5s linear infinite"
        },
        "ë”¸": {
            background: "radial-gradient(circle, #ffb6c1 0%, #ff69b4 30%, #ffc0cb 70%, #ffb6c1 100%)",
            borderRadius: "50%",
            boxShadow: "0 0 40px rgba(255, 182, 193, 1), 0 0 80px rgba(255, 182, 193, 0.8), 0 0 120px rgba(255, 182, 193, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.4)",
            transform: "scale(1.4)",
            animation: "bounce 1s ease-in-out infinite"
        },
        "ì†Œì„¸ì§€ ì†ê°€ë½": {
            background: "conic-gradient(from 45deg, #ff6347, #ff4500, #ffa500, #ff6347)",
            borderRadius: "50%",
            boxShadow: "0 0 50px rgba(255, 99, 71, 1), 0 0 100px rgba(255, 99, 71, 0.8), 0 0 150px rgba(255, 99, 71, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.2)",
            transform: "scale(1.5)",
            animation: "wiggle 0.8s ease-in-out infinite"
        },
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": {
            background: "radial-gradient(circle, #2f2f2f 0%, #1a1a1a 50%, #000000 100%)",
            borderRadius: "50%",
            boxShadow: "0 0 30px rgba(47, 47, 47, 1), 0 0 60px rgba(47, 47, 47, 0.8), 0 0 90px rgba(47, 47, 47, 0.6)",
            transform: "scale(1.2)",
            animation: "fade 2s ease-in-out infinite"
        }
    };

    const effect = cursorEffects[text];
    if (effect) {
        cursorImage.style.background = effect.background;
        cursorImage.style.borderRadius = effect.borderRadius;
        cursorImage.style.boxShadow = effect.boxShadow;
        cursorImage.style.transform = effect.transform;
        cursorImage.style.animation = effect.animation;
        cursorImage.style.backgroundImage = "none"; // ê¸°ë³¸ ì´ë¯¸ì§€ ì œê±°
    }

    // ë©”ì¸ íŒŒí‹°í´ ìº”ë²„ìŠ¤ë¥¼ ìˆ¨ê¹€
    canvas.style.display = 'none';
    
    // í…ìŠ¤íŠ¸ì— ë”°ë¼ ë™ì˜ìƒ íŒŒì¼ ê²½ë¡œ ì„¤ì •
    // âš ï¸ íŒŒì¼ ì´ë¦„ê³¼ ê²½ë¡œê°€ ì •í™•í•´ì•¼ í•©ë‹ˆë‹¤!
    const videoMap = {
        "ì œë¹µì‚¬": "baker.mp4",        // ì˜ˆì‹œ: baker.mp4 íŒŒì¼ í•„ìš”
        "ì—„ë§ˆ": "mother.mp4",        // ì˜ˆì‹œ: mother.mp4 íŒŒì¼ í•„ìš”
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": "kungfu.mp4",    // ì˜ˆì‹œ: kungfu.mp4 íŒŒì¼ í•„ìš”
        "ê³¼í•™ì": "scientist.mp4",   // ... ì´í•˜ ë™ì˜ìƒ íŒŒì¼ í•„ìš” ...
        "ê¸¸ê°€ì˜ ëŒë©©ì´": "rock.mp4",
        "ê°€ìˆ˜": "singer.mp4",
        "ë”¸": "daughter.mp4",
        "ì†Œì„¸ì§€ ì†ê°€ë½": "sausage.mp4",
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": "nothing.mp4" // ì˜ˆ: ê²€ì€ í™”ë©´ ì˜ìƒ ë˜ëŠ” íš¨ê³¼ ì˜ìƒ
    };
    
    // ê° ì°¨ì›ë³„ ìŒì•… íŒŒì¼ ê²½ë¡œ ì„¤ì •
    const musicMap = {
        "ì œë¹µì‚¬": "baker.mp3",
        "ì—„ë§ˆ": "mother.mp3",
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": "kungfu.mp3",
        "ê³¼í•™ì": "scientist.mp3",
        "ê¸¸ê°€ì˜ ëŒë©©ì´": "rock.mp3",
        "ê°€ìˆ˜": "singer.mp3",
        "ë”¸": "daughter.mp3",
        "ì†Œì„¸ì§€ ì†ê°€ë½": "sausage.mp3",
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": "nothing.mp3"
    };
    
    const videoSrc = videoMap[text];
    const musicSrc = musicMap[text];

    // --- â¬‡ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ 1 â¬‡ï¸ ---
    let dimensionMusic = null; // 'const' ëŒ€ì‹  'let'ìœ¼ë¡œ ì—¬ê¸°ì„œ ì„ ì–¸

    if (!videoSrc) {
        console.error(`"${text}"ì— í•´ë‹¹í•˜ëŠ” ë™ì˜ìƒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        showSubtitle(`"${text}" ê²½í—˜ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        canvas.style.display = 'block'; // íŒŒí‹°í´ ìº”ë²„ìŠ¤ ë‹¤ì‹œ ì¼œê¸°
        return; // í•¨ìˆ˜ ì¢…ë£Œ
    }

    // ë°°ê²½ ë™ì˜ìƒ ìš”ì†Œ ì„¤ì • ë° ì¬ìƒ
    backgroundVideo.src = videoSrc;
    backgroundVideo.style.display = 'block';
    backgroundVideo.style.opacity = '1'; // CSS transitionìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚¨
    backgroundVideo.currentTime = 0; // ì²˜ìŒë¶€í„° ì¬ìƒ
    backgroundVideo.play().catch(error => {
        console.error("ë™ì˜ìƒ ì¬ìƒ ì˜¤ë¥˜:", error);
        showSubtitle("ë™ì˜ìƒì„ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        // ì˜¤ë¥˜ ì‹œ ë³µêµ¬
        backgroundVideo.style.display = 'none';
        backgroundVideo.style.opacity = '0';
        canvas.style.display = 'block';
    });
    
    // ì°¨ì›ë³„ ìŒì•… ì¬ìƒ
    if (musicSrc) {
        // --- â¬‡ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ 2 â¬‡ï¸ ---
        dimensionMusic = new Audio(musicSrc); // ì„ ì–¸ëœ ë³€ìˆ˜ì— í• ë‹¹
        dimensionMusic.volume = 0.6; // ë³¼ë¥¨ ì¡°ì ˆ
        dimensionMusic.play().catch(error => {
            console.log(`${text} ìŒì•… ì¬ìƒ ì‹¤íŒ¨:`, error);
        });
    }
    
    // í…ìŠ¤íŠ¸ì— ë”°ë¥¸ ìƒ‰ê¹” í•„í„° ì ìš© (ë°°ê²½ ë™ì˜ìƒì— ì ìš©)
    const filterMap = {
        "ì œë¹µì‚¬": "blur(2px) brightness(1.3) contrast(1.2) saturate(1.5) ",
        "ì—„ë§ˆ": "blur(1px) brightness(1.2) contrast(1.1) saturate(1.3) ",
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": "blur(3px) brightness(0.8) contrast(1.5) saturate(0.5))",
        "ê³¼í•™ì": "blur(1px) brightness(1.4) contrast(1.3) saturate(0.8)",
        "ê¸¸ê°€ì˜ ëŒë©©ì´": "blur(5px) brightness(0.7) contrast(1.2) saturate(0.3) ",
        "ê°€ìˆ˜": "blur(1px) brightness(1.5) contrast(1.4) saturate(2.0)",
        "ë”¸": "blur(1px) brightness(1.3) contrast(1.1) saturate(1.4)",
        "ì†Œì„¸ì§€ ì†ê°€ë½": "blur(1px) brightness(1.2) contrast(1.1) saturate(1.2) hue-rotate(-10deg)",
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": "blur(10px) brightness(0.5) contrast(2.0) saturate(0) "
    };
    backgroundVideo.style.filter = filterMap[text] || "blur(2px) brightness(1.1) contrast(1.2) saturate(0.8)";
    
    const soundMap = {
        "ì œë¹µì‚¬": playBakerSound,
        "ì—„ë§ˆ": playMotherSound,
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": playKungfuSound,
        "ê³¼í•™ì": playScientistSound,
        "ê¸¸ê°€ì˜ ëŒë©©ì´": playRockSound,
        "ê°€ìˆ˜": playSingerSound,
        "ë”¸": playDaughterSound,
        "ì†Œì„¸ì§€ ì†ê°€ë½": playSausageSound,
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": playNothingSound
    };
    
    // í•´ë‹¹ ì°¨ì›ì˜ ì‚¬ìš´ë“œ ì¬ìƒ
    if (soundMap[text]) {
        soundMap[text]();
    }
    
    // í™•ì¥ëœ ì°¨ì› ë©”ì‹œì§€ (ìë§‰)
    const experienceMessages = {
        "ì œë¹µì‚¬": "ë”°ëœ»í•œ ë¹µëƒ„ìƒˆê°€ ê°€ë“í•œ ë¹µì§‘ì—ì„œ ë‹¹ì‹ ì€ ì™„ë²½í•œ ë¹µì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤.",
        "ì—„ë§ˆ": "ì•„ì´ë“¤ì˜ ì›ƒìŒì†Œë¦¬ê°€ ê°€ë“í•œ ì§‘ì—ì„œ ë‹¹ì‹ ì€ ì‚¬ë‘ìœ¼ë¡œ ê°€ë“í•œ ì—„ë§ˆì…ë‹ˆë‹¤.",
        "ì¿µí‘¸ ë§ˆìŠ¤í„°": "ê³ ìš”í•œ ì‚¬ì›ì—ì„œ ë‹¹ì‹ ì€ í‰í™”ì™€ í˜ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.",
        "ê³¼í•™ì": "ì‹¤í—˜ì‹¤ì—ì„œ ë‹¹ì‹ ì€ ìš°ì£¼ì˜ ë¹„ë°€ì„ í’€ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤.",
        "ê¸¸ê°€ì˜ ëŒë©©ì´": "ê³ ìš”í•œ ê¸¸ê°€ì—ì„œ ë‹¹ì‹ ì€ í‰í™”ë¡œìš´ ì¡´ì¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "ê°€ìˆ˜": "ë¬´ëŒ€ ìœ„ì—ì„œ ë‹¹ì‹ ì€ ëª¨ë“  ì´ì˜ ë§ˆìŒì„ ì›€ì§ì…ë‹ˆë‹¤.",
        "ë”¸": "ë¶€ëª¨ë‹˜ì˜ ì‚¬ë‘ì„ ë°›ìœ¼ë©° ìë¼ëŠ” ì†Œì¤‘í•œ ì¡´ì¬ì…ë‹ˆë‹¤.",
        "ì†Œì„¸ì§€ ì†ê°€ë½": "ì†ê°€ë½ì´ ì†Œì„¸ì§€ì²˜ëŸ¼ ë¶€í’€ì–´ ì˜¤ë¥´ëŠ” ìˆœê°„, ë‹¹ì‹ ì€ í˜„ì‹¤ê³¼ í‰í–‰ ì„¸ê³„ê°€ ë’¤ì„ì¸ í˜¼ëˆ ì†ì— ì„œ ìˆìŠµë‹ˆë‹¤.",
        "ì•„ë¬´ê²ƒë„ ì•„ë‹Œ": "ë¬´í•œí•œ ê³µí—ˆ ì†ì—ì„œ ë‹¹ì‹ ì€ ì¡´ì¬ì˜ ì˜ë¯¸ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤."
    };
    const message = experienceMessages[text] || `ë‹¹ì‹ ì€ ${text}ì˜ ê²½í—˜ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
    showSubtitle(message);
    
    // ì²´í—˜ íšŸìˆ˜ ì¦ê°€
    experienceCount++;
    console.log(`ì²´í—˜ ì™„ë£Œ: ${experienceCount}/3`);
    
    // ì§„í–‰ë°” ì—…ë°ì´íŠ¸
    updateProgress();
    
    // 5ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µê·€
    setTimeout(() => {
        // ë°°ê²½ ë™ì˜ìƒ ìˆ¨ê¸°ê¸°
        backgroundVideo.style.opacity = '0'; // ë¶€ë“œëŸ½ê²Œ ì‚¬ë¼ì§
        // opacity transitionì´ ëë‚œ í›„ display none ì²˜ë¦¬
        setTimeout(() => { 
            backgroundVideo.style.display = 'none';
            backgroundVideo.pause(); // ì¬ìƒ ì¤‘ì§€
            backgroundVideo.src = ""; // ì†ŒìŠ¤ ì œê±° (ë©”ëª¨ë¦¬ ì ˆì•½)
        }, 500); // CSS transition ì‹œê°„ê³¼ ì¼ì¹˜ (0.5s)

        // --- â¬‡ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ 3 (ì¶”ê°€) â¬‡ï¸ ---
        // ìŒì•… ì •ì§€
        if (dimensionMusic) {
            dimensionMusic.pause();
            dimensionMusic.currentTime = 0; // ì¬ìƒ ìœ„ì¹˜ë¥¼ ì²˜ìŒìœ¼ë¡œ
        }
        // --- â¬†ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ 3 (ì¶”ê°€) â¬†ï¸ ---

        backgroundVideo.style.filter = 'none'; // í•„í„° ë¦¬ì…‹
        
        // ë©”ì¸ ìº”ë²„ìŠ¤ ë‹¤ì‹œ í‘œì‹œ
        canvas.style.display = 'block';
        
        // ì»¤ì„œë¥¼ ì›ë˜ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°
        cursorImage.style.background = 'transparent'; // íˆ¬ëª… ë°°ê²½
        cursorImage.style.borderRadius = '0';
        cursorImage.style.boxShadow = 'none'; // ê¸€ë¡œìš° íš¨ê³¼ ì œê±°
        cursorImage.style.transform = 'scale(1)';
        cursorImage.style.animation = 'none'; // ì• ë‹ˆë©”ì´ì…˜ ì œê±°
        cursorImage.style.backgroundImage = "url('1.png')";
        cursorImage.style.backgroundSize = 'contain';
        cursorImage.style.backgroundRepeat = 'no-repeat';
        cursorImage.style.backgroundPosition = 'center';
        
        // ì™¼ìª½ ë°”ë¥¼ ì›ë˜ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°
        stageText.textContent = 'CHOOSING DIMENSION';
        
        mouse.hoverTarget = null;
        
        if (experienceCount >= 3) {
            showSubtitle("ëª¨ë“  ì°¨ì›ì˜ ê²½í—˜ì´ ëª¨ì˜€ìŠµë‹ˆë‹¤. í˜¼ëˆì´ ìˆ˜ë ´í•©ë‹ˆë‹¤.");
            setTimeout(() => {
                advanceSection(); // ì†Œìš©ëŒì´ ì‹œì‘
            }, 2000);
        } else {
            showSubtitle(`${3 - experienceCount}ê°œì˜ ë‹¤ë¥¸ ì°¨ì›ì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.`);
        }
    }, 5000); // 5ì´ˆ
}
// -------------------- ì„¹ì…˜ ê´€ë¦¬ --------------------
function advanceSection() { 
    if (section < 6) { 
        section++; 
        console.log("Advancing to section: ", section); 
        handleSectionChange(); 
        if (sectionDurations[section] !== undefined) {
            // ì„¹ì…˜ 3ì˜ íƒ€ì´ë¨¸ëŠ” startExperienceì—ì„œ 3ë²ˆ ì™„ë£Œ í›„ ìˆ˜ë™ í˜¸ì¶œí•˜ë¯€ë¡œ ì œê±°
            if (section !== 3) { 
                setTimeout(advanceSection, sectionDurations[section]); 
            }
        } 
    } 
}
function handleSectionChange(){
    showSubtitle(sectionMessages[section]);
    updateProgress();
    updateStage();

    if (section === 0) { 
        particles = []; 
        glowParticles = []; 
        for (let i = 0; i < 200; i++) { 
            const p = new Particle(Math.random()*width, Math.random()*height, 5 + Math.random() * 10, getRandomColor()); 
            p.isChoiceParticle = true; 
            particles.push(p); 
        } 
        for (let i = 0; i < 20; i++) {
            glowParticles.push(new GlowParticle(Math.random()*width, Math.random()*height)); 
        } 
        
        // ì°¨ì› ì„ íƒ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
        setTimeout(() => {
            showSubtitle("í—ˆê³µì— ë– ë„ëŠ” ì ì„ í´ë¦­í•˜ì—¬ ì°¨ì›ì„ ì„ íƒí•˜ì„¸ìš”.");
        }, 2000); // 2ì´ˆ í›„ì— ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
    } 
    else if (section === 1) { 
        const selectedParticle = particles.find(p => p.isSelected); 
        if (selectedParticle) selectedBaseColor = selectedParticle.color; 
    } 
    else if (section === 2) { 
        particles = []; 
        shockwaves = []; 
        glowParticles = []; 
        for(let i=0; i<150; i++) { 
            const shadedColor = getShadedColor(selectedBaseColor || 'rgb(200,200,200)'); 
            particles.push(new Particle(Math.random()*width, Math.random()*height, 2 + Math.random()*3, shadedColor)); 
        } 
        for (let i = 0; i < 30; i++) {
            glowParticles.push(new GlowParticle(Math.random()*width, Math.random()*height)); 
        } 
    } 
     else if (section === 3) { 
          experienceCount = 0; // ì²´í—˜ íšŸìˆ˜ ì´ˆê¸°í™”
          sectionStartTime = Date.now(); // ì„¹ì…˜ ì‹œì‘ ì‹œê°„ ê¸°ë¡
          updateProgress(); // ì§„í–‰ë°” ì´ˆê¸°í™”
          
          particles = []; // ì´ì „ íŒŒí‹°í´ ì§€ìš°ê¸°
          
          // í…ìŠ¤íŠ¸ íŒŒí‹°í´ ìƒì„± (í´ë¦­ ê°€ëŠ¥í•œ ì°¨ì› ì²´í—˜)
          for(let i=0; i<100; i++) {
             particles.push(new Particle(Math.random()*width, Math.random()*height, 3+Math.random()*5, getRandomColor(), phrases[Math.floor(Math.random() * phrases.length)])); 
         }
         
         // ì¡°ê°ë‚œ í˜„ì‹¤ íŒŒí‹°í´ ìƒì„± (ì„¹ì…˜ 2ì™€ ìœ ì‚¬í•œ íš¨ê³¼)
         for(let i=0; i<100; i++) { 
             const shadedColor = getShadedColor(selectedBaseColor || 'rgb(200,200,200)'); 
             particles.push(new Particle(Math.random()*width, Math.random()*height, 2 + Math.random()*3, shadedColor)); 
         }
         
         glowParticles = []; 
         for (let i = 0; i < 50; i++) {
             glowParticles.push(new GlowParticle(Math.random()*width, Math.random()*height)); 
         } 
          // ì„¹ì…˜ 3ì˜ ìë™ ì „í™˜ íƒ€ì´ë¨¸ëŠ” ì œê±° (startExperienceì—ì„œ ê´€ë¦¬)
     }
    else if (section === 4) { 
        playSwellingSound(15); 
        convergenceStartTime = Date.now(); 
        // ì„¹ì…˜ 4ëŠ” ìë™ ì „í™˜ ì‹œê°„ ì—†ìŒ (í´ë¦­ ëŒ€ê¸°)
    } 
    else if (section === 5) { 
        playClimaxSound(); 
        particles = []; // ìˆ˜ë ´ í›„ íŒŒí‹°í´ ì œê±°
        embers = []; 
        for(let i = 0; i < 200; i++) {
            embers.push(new Ember()); 
        }
        glowParticles = []; 
        for (let i = 0; i < 50; i++) {
            glowParticles.push(new GlowParticle(centerX + (Math.random()-0.5)*100, centerY + (Math.random()-0.5)*100)); 
        } 
        // ì„¹ì…˜ 5ëŠ” flash íš¨ê³¼ í›„ ìë™ìœ¼ë¡œ ì„¹ì…˜ 6ìœ¼ë¡œ ì „í™˜ë¨ (animate í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬)
    } 
    else if (section === 6) { 
        document.body.style.background = '#000000';
        document.getElementById('finalText').style.opacity = 1;
        
        // ë² ì´ê¸€ ëŒ€ì‚¬ ìŠ¤íƒ€ì¼ ë©”ì‹œì§€ í‘œì‹œ
        const bagelMessage = finalBagelQuotes[Math.floor(Math.random() * finalBagelQuotes.length)];
        showSubtitle(bagelMessage);
        
        // ì›¹ìº ì„ ë°°ê²½ìœ¼ë¡œ ì„œì„œíˆ í‘œì‹œ
        if (webcamPermissionGranted && webcamStream) {
            webcamVideo.style.display = 'block';
            webcamVideo.style.zIndex = '1';
            webcamVideo.style.filter = 'blur(2px) brightness(1.2) contrast(1.5) saturate(0) grayscale(100%)';
            
            // ì—”ë”©ê³¡ ì¬ìƒ
            const endingMusic = new Audio('ending.mp3');
            endingMusic.volume = 0.7; // ë³¼ë¥¨ ì¡°ì ˆ
            endingMusic.play().catch(error => {
                console.log('ì—”ë”©ê³¡ ì¬ìƒ ì‹¤íŒ¨:', error);
            });
            
            // ì„œì„œíˆ ë‚˜íƒ€ë‚˜ë„ë¡ opacityë¥¼ ì§€ì—°ì‹œì¼œ ë³€ê²½
            setTimeout(() => {
                webcamVideo.style.opacity = '1';
                
                // ìë§‰ì´ ì‚¬ë¼ì§„ í›„ ì´¬ì˜ ë²„íŠ¼ í‘œì‹œ
                setTimeout(() => {
                    document.getElementById('cameraButton').style.display = 'block';
                }, 8000); // ìë§‰ì´ 8ì´ˆ í›„ì— ì‚¬ë¼ì§€ë¯€ë¡œ ê·¸ í›„ì— ë²„íŠ¼ í‘œì‹œ
            }, 500); // 0.5ì´ˆ í›„ì— ì„œì„œíˆ ë‚˜íƒ€ë‚¨
        }
        
        canvas.style.display = 'none'; // íŒŒí‹°í´ ìº”ë²„ìŠ¤ ìˆ¨ê¹€
        backgroundVideo.style.display = 'none'; // ë°°ê²½ ë¹„ë””ì˜¤ ìˆ¨ê¹€
    }
}

// --- ìµœì¢… ë¶•ê´´ í•¨ìˆ˜ ---
async function initiateFinalCollapse() {
    isAwaitingFinalClick = false; 
    isCollapsing = true; 
    playFinalCollapseSound();
    
    document.body.style.background = 'transparent';
    
    const collapseInterval = setInterval(() => {
        let allGone = true;
        particles.forEach(p => {
            p.dx += (centerX - p.x) * 0.05; p.dy += (centerY - p.y) * 0.05;
            p.x += p.dx; p.y += p.dy; p.r -= 0.2;
            if (p.r > 0.1) allGone = false; // íŒŒí‹°í´ì´ ì™„ì „íˆ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸
            else p.r = 0; // 0 ë¯¸ë§Œ ë°©ì§€
        });
        if (allGone) { 
            clearInterval(collapseInterval); 
            console.log("Collapse finished, advancing to section 5");
            advanceSection(); 
        }
    }, 16); // ì•½ 60fps
}


// -------------------- ë©”ì¸ ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ (íŒŒí‹°í´) --------------------
function animate(){
    ctx.save();
    if(screenShake.intensity > 0) { ctx.translate((Math.random() - 0.5) * screenShake.intensity, (Math.random() - 0.5) * screenShake.intensity); screenShake.intensity *= 0.9; }

    if (isCollapsing) {
        // ë¶•ê´´ ì¤‘ì¼ ë•ŒëŠ” ìº”ë²„ìŠ¤ë¥¼ íˆ¬ëª…í•˜ê²Œ ì§€ì›€
        ctx.clearRect(-width, -height, width * 2, height * 2);
    } else {
        // í‰ì†Œì—ëŠ” ì”ìƒ íš¨ê³¼ë¥¼ ìœ„í•´ ë°˜íˆ¬ëª… í°ìƒ‰ìœ¼ë¡œ ë®ìŒ
        const clearAlpha = section === 4 ? 0.1 : 0.25;
        ctx.fillStyle = `rgba(255, 255, 255, ${clearAlpha})`;
        ctx.fillRect(-width, -height, width * 2, height * 2);
    }
    
    if (mouse.down && section === 3) {
        if(Math.random() < 0.3) screenShake.intensity = 15;
        if(Math.random() < 0.01 && glitchEffect.duration <= 0) { 
            glitchEffect.type = 'gravity'; 
            glitchEffect.duration = 120; 
        } 
    }
    if(glitchEffect.duration > 0) glitchEffect.duration--; else glitchEffect.type = 'none';

    mouse.hoverTarget = null;
    if (section === 0) { 
        for (let i = particles.length - 1; i >= 0; i--) { 
            const p = particles[i]; 
            const dist = Math.sqrt((p.x - mouse.x)**2 + (p.y - mouse.y)**2); 
            if(dist < p.r && !p.isShattered) { 
                mouse.hoverTarget = p; 
                break; 
            } 
        } 
    } else if (section === 3) {
        // ì„¹ì…˜ 3: í…ìŠ¤íŠ¸ íŒŒí‹°í´ ì„ íƒ ë¡œì§
        for (let i = particles.length - 1; i >= 0; i--) { 
            const p = particles[i]; 
            if (p.text) { // í…ìŠ¤íŠ¸ê°€ ìˆëŠ” íŒŒí‹°í´ë§Œ
                const dist = Math.sqrt((p.x - mouse.x)**2 + (p.y - mouse.y)**2); 
                if(dist < p.r * 4) { // í´ë¦­ ì˜ì—­ì„ ë” í¬ê²Œ í™•ì¥
                    mouse.hoverTarget = p; 
                    break; 
                } 
            }
        }
    }

    // --- ê° ì„¹ì…˜ë³„ ê·¸ë¦¬ê¸° ë¡œì§ ---
    if (section < 5) { // ì„¹ì…˜ 0 ~ 4
        particles.forEach(p => { p.update(); p.draw(ctx); });
        glowParticles.forEach(gp => { gp.update(); gp.draw(ctx); });
        
        // ì‚¬ë¼ì§„ íŒŒí‹°í´ ì œê±°
        particles = particles.filter(p => !((p.isShattered && p.alpha <= 0) || (section === 1 && !p.isSelected && p.alpha <= 0) || p.r <= 0.1));
        glowParticles = glowParticles.filter(gp => gp.life > 0);
        
        // ì„¹ì…˜ 4 í´ë¦­ ëŒ€ê¸° ì²˜ë¦¬
        if (section === 4 && !isAwaitingFinalClick) {
             if(Date.now() - convergenceStartTime > 15000) { // 17ì´ˆ í›„ í´ë¦­ ìš”ì²­
                 isAwaitingFinalClick = true; 
                 showSubtitle("ì´ì œ í´ë¦­í•˜ì—¬ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ í†µí•©í•˜ì„¸ìš”!"); 
             } 
        }
    } else if (section === 5) { // ì„¹ì…˜ 5: Climax (Flash)
        if(flashRadius < Math.max(width, height)) { // í™”ë©´ ì „ì²´ë¥¼ ë®ë„ë¡ ìˆ˜ì •
             flashRadius += Math.max(width, height) * 0.03; 
        } else { 
             flashAlpha -= 0.02; 
        }
        let grad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, flashRadius);
        grad.addColorStop(0, `rgba(255,255,255,${flashAlpha})`); 
        grad.addColorStop(0.4, `rgba(255, 255, 0, ${flashAlpha*0.7})`); 
        grad.addColorStop(0.7, `rgba(255, 0, 255, ${flashAlpha*0.7})`); 
        grad.addColorStop(1, `rgba(0,0,0,0)`);
        ctx.fillStyle = grad; 
        ctx.fillRect(-width, -height, width*2, height*2); // í™”ë©´ ì „ì²´ë¥¼ ì±„ì›€
        
        glowParticles.forEach(gp => { gp.update(); gp.draw(ctx); });
        glowParticles = glowParticles.filter(gp => gp.life > 0);
        
        // í”Œë˜ì‹œ íš¨ê³¼ ëë‚˜ë©´ ë‹¤ìŒ ì„¹ì…˜ìœ¼ë¡œ
        if(flashAlpha <= 0) {
             console.log("Flash finished, advancing to section 6");
             advanceSection();
        }
    } else if (section === 6) { // ì„¹ì…˜ 6: Finale
        embers.forEach(e => { e.update(); e.draw(ctx); }); 
        embers = embers.filter(e => e.life > 0);
        glowParticles.forEach(gp => { gp.update(); gp.draw(ctx); }); 
        glowParticles = glowParticles.filter(gp => gp.life > 0);
        // ì„¹ì…˜ 6ì—ì„œëŠ” íŒŒí‹°í´/ì— ë²„ê°€ ì„œì„œíˆ ì‚¬ë¼ì§
    }
    
    // ì¶©ê²©íŒŒëŠ” í•­ìƒ ê·¸ë¦¼
    shockwaves.forEach(sw => { sw.update(); sw.draw(ctx); }); 
    shockwaves = shockwaves.filter(sw => sw.life > 0);
    
    ctx.restore();
    requestAnimationFrame(animate); // ë‹¤ìŒ í”„ë ˆì„ ìš”ì²­
}

// -------------------- ì‚¬ìš´ë“œ ì—”ì§„ --------------------
const audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
let glitchNode = null; 
function playTone(frequency, duration, volume = 0.2){ const oscillator = audioCtx.createOscillator(); const gainNode = audioCtx.createGain(); oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime); gainNode.gain.setValueAtTime(volume, audioCtx.currentTime); oscillator.connect(gainNode); gainNode.connect(audioCtx.destination); oscillator.start(); oscillator.stop(audioCtx.currentTime + duration); }
function playGlitchSound() { if (Math.random() < 0.1) { playWhiteNoiseBurst(); return; } if (glitchNode) return; const duration = 0.05 + Math.random() * 0.2; glitchNode = audioCtx.createOscillator(); const gainNode = audioCtx.createGain(); glitchNode.type = ['sawtooth', 'square', 'triangle'][Math.floor(Math.random()*3)]; glitchNode.frequency.setValueAtTime(60 + Math.random() * 200, audioCtx.currentTime); glitchNode.detune.setValueAtTime(Math.random() * 100, audioCtx.currentTime); gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration); glitchNode.connect(gainNode); gainNode.connect(audioCtx.destination); glitchNode.start(); glitchNode.stop(audioCtx.currentTime + duration); glitchNode.onended = () => { glitchNode = null; if(mouse.down && section === 3) playGlitchSound(); } } 
function stopGlitchSound(){ if(glitchNode) glitchNode.onended = null; }
function playSwellingSound(duration) { const bassOsc = audioCtx.createOscillator(); const bassGain = audioCtx.createGain(); bassOsc.type = 'sine'; bassOsc.frequency.setValueAtTime(60, audioCtx.currentTime); bassOsc.frequency.exponentialRampToValueAtTime(120, audioCtx.currentTime + duration); bassGain.gain.setValueAtTime(0.01, audioCtx.currentTime); bassGain.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + duration * 0.8); bassGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration); bassOsc.connect(bassGain); bassGain.connect(audioCtx.destination); bassOsc.start(); bassOsc.stop(audioCtx.currentTime + duration); const harmonicOsc = audioCtx.createOscillator(); const harmonicGain = audioCtx.createGain(); harmonicOsc.type = 'sine'; harmonicOsc.frequency.setValueAtTime(200, audioCtx.currentTime); harmonicOsc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + duration); harmonicGain.gain.setValueAtTime(0.01, audioCtx.currentTime); harmonicGain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + duration * 0.8); harmonicGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration); harmonicOsc.connect(harmonicGain); harmonicGain.connect(audioCtx.destination); harmonicOsc.start(); harmonicOsc.stop(audioCtx.currentTime + duration); }
function playClimaxSound() { const rumble = audioCtx.createOscillator(); const rumbleGain = audioCtx.createGain(); rumble.type = 'sine'; rumble.frequency.setValueAtTime(40, audioCtx.currentTime); rumbleGain.gain.setValueAtTime(0.8, audioCtx.currentTime); rumbleGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 2.5); rumble.connect(rumbleGain); rumbleGain.connect(audioCtx.destination); rumble.start(); rumble.stop(audioCtx.currentTime + 2.5); const shimmer = audioCtx.createOscillator(); const shimmerGain = audioCtx.createGain(); shimmer.type = 'sine'; shimmer.frequency.setValueAtTime(1200, audioCtx.currentTime); shimmerGain.gain.setValueAtTime(0, audioCtx.currentTime); shimmerGain.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 1.5); shimmerGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2.5); shimmer.connect(shimmerGain); shimmerGain.connect(audioCtx.destination); shimmer.start(); shimmer.stop(audioCtx.currentTime + 2.5); const harmonic = audioCtx.createOscillator(); const harmonicGain = audioCtx.createGain(); harmonic.type = 'triangle'; harmonic.frequency.setValueAtTime(600, audioCtx.currentTime); harmonicGain.gain.setValueAtTime(0, audioCtx.currentTime); harmonicGain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + 1.0); harmonicGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2.5); harmonic.connect(harmonicGain); harmonicGain.connect(audioCtx.destination); harmonic.start(); harmonic.stop(audioCtx.currentTime + 2.5); }
function playChimeSound() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sine'; osc.frequency.setValueAtTime(880, audioCtx.currentTime); gain.gain.setValueAtTime(0.4, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.0); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 1.0); }
function playFallingSound() { const sounds = [ () => { const osc1 = audioCtx.createOscillator(); const gain1 = audioCtx.createGain(); osc1.type = 'sine'; osc1.frequency.setValueAtTime(400, audioCtx.currentTime); osc1.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.8); gain1.gain.setValueAtTime(0.3, audioCtx.currentTime); gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8); osc1.connect(gain1); gain1.connect(audioCtx.destination); osc1.start(); osc1.stop(audioCtx.currentTime + 0.8); }, () => { const osc2 = audioCtx.createOscillator(); const gain2 = audioCtx.createGain(); osc2.type = 'triangle'; osc2.frequency.setValueAtTime(600, audioCtx.currentTime); osc2.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 1.2); gain2.gain.setValueAtTime(0.2, audioCtx.currentTime); gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.2); osc2.connect(gain2); gain2.connect(audioCtx.destination); osc2.start(); osc2.stop(audioCtx.currentTime + 1.2); }, () => { const osc3 = audioCtx.createOscillator(); const gain3 = audioCtx.createGain(); osc3.type = 'sawtooth'; osc3.frequency.setValueAtTime(800, audioCtx.currentTime); osc3.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 1.0); gain3.gain.setValueAtTime(0.25, audioCtx.currentTime); gain3.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.0); osc3.connect(gain3); gain3.connect(audioCtx.destination); osc3.start(); osc3.stop(audioCtx.currentTime + 1.0); } ]; const randomSound = sounds[Math.floor(Math.random() * sounds.length)]; randomSound(); }
function playFinalCollapseSound() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sawtooth'; osc.frequency.setValueAtTime(500, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5); gain.gain.setValueAtTime(0.4, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.5); }
function playWhiteNoiseBurst() { const bufferSize = audioCtx.sampleRate * 0.2; const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate); let data = buffer.getChannelData(0); for (let i = 0; i < bufferSize; i++) { data[i] = Math.random() * 2 - 1; } const noiseNode = audioCtx.createBufferSource(); noiseNode.buffer = buffer; const gainNode = audioCtx.createGain(); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); noiseNode.connect(gainNode); gainNode.connect(audioCtx.destination); noiseNode.start(); }

// ì°¨ì›ë³„ ì‚¬ìš´ë“œ íš¨ê³¼ í•¨ìˆ˜ë“¤
function playBakerSound() {
    // ë”°ëœ»í•œ ë¹µì§‘ ì†Œë¦¬ - ë‚®ì€ í†¤ì˜ ë”°ëœ»í•œ ì‚¬ìš´ë“œ
    const osc1 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    osc1.type = 'sine';
    osc1.frequency.setValueAtTime(220, audioCtx.currentTime); // A3
    osc1.frequency.exponentialRampToValueAtTime(330, audioCtx.currentTime + 2);
    gain1.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 2);
    osc1.connect(gain1);
    gain1.connect(audioCtx.destination);
    osc1.start();
    osc1.stop(audioCtx.currentTime + 2);
}

function playMotherSound() {
    // ë”°ëœ»í•œ ê°€ì • ì†Œë¦¬ - ë¶€ë“œëŸ¬ìš´ í•˜ëª¨ë‹ˆ
    const osc1 = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    const gain2 = audioCtx.createGain();
    
    osc1.type = 'sine';
    osc1.frequency.setValueAtTime(261.63, audioCtx.currentTime); // C4
    gain1.gain.setValueAtTime(0.08, audioCtx.currentTime);
    gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 2.5);
    
    osc2.type = 'sine';
    osc2.frequency.setValueAtTime(329.63, audioCtx.currentTime); // E4
    gain2.gain.setValueAtTime(0.06, audioCtx.currentTime);
    gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 2.5);
    
    osc1.connect(gain1);
    osc2.connect(gain2);
    gain1.connect(audioCtx.destination);
    gain2.connect(audioCtx.destination);
    
    osc1.start();
    osc2.start();
    osc1.stop(audioCtx.currentTime + 2.5);
    osc2.stop(audioCtx.currentTime + 2.5);
}

function playKungfuSound() {
    // ê³ ìš”í•œ ì‚¬ì› ì†Œë¦¬ - ê¹Šê³  í‰í™”ë¡œìš´ í†¤
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(146.83, audioCtx.currentTime); // D3
    osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 3);
    gain.gain.setValueAtTime(0.12, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 3);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 3);
}

function playScientistSound() {
    // ì°¨ê°€ìš´ ì‹¤í—˜ì‹¤ ì†Œë¦¬ - ì „ììŒ ê°™ì€ íš¨ê³¼
    const osc1 = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    const gain2 = audioCtx.createGain();
    
    osc1.type = 'sawtooth';
    osc1.frequency.setValueAtTime(800, audioCtx.currentTime);
    osc1.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 1.5);
    gain1.gain.setValueAtTime(0.05, audioCtx.currentTime);
    gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.5);
    
    osc2.type = 'triangle';
    osc2.frequency.setValueAtTime(400, audioCtx.currentTime);
    osc2.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 1.5);
    gain2.gain.setValueAtTime(0.04, audioCtx.currentTime);
    gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.5);
    
    osc1.connect(gain1);
    osc2.connect(gain2);
    gain1.connect(audioCtx.destination);
    gain2.connect(audioCtx.destination);
    
    osc1.start();
    osc2.start();
    osc1.stop(audioCtx.currentTime + 1.5);
    osc2.stop(audioCtx.currentTime + 1.5);
}

function playRockSound() {
    // ê³ ìš”í•œ ìì—° ì†Œë¦¬ - ë§¤ìš° ë‚®ì€ í†¤
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(82.41, audioCtx.currentTime); // E2
    osc.frequency.exponentialRampToValueAtTime(55, audioCtx.currentTime + 4);
    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 4);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 4);
}

function playSingerSound() {
    // í™”ë ¤í•œ ë¬´ëŒ€ ì†Œë¦¬ - ë†’ì€ í†¤ì˜ ë©œë¡œë””
    const osc1 = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    const gain2 = audioCtx.createGain();
    
    osc1.type = 'sine';
    osc1.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
    osc1.frequency.exponentialRampToValueAtTime(659.25, audioCtx.currentTime + 1);
    gain1.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
    
    osc2.type = 'sine';
    osc2.frequency.setValueAtTime(783.99, audioCtx.currentTime); // G5
    osc2.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 1);
    gain2.gain.setValueAtTime(0.08, audioCtx.currentTime);
    gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
    
    osc1.connect(gain1);
    osc2.connect(gain2);
    gain1.connect(audioCtx.destination);
    gain2.connect(audioCtx.destination);
    
    osc1.start();
    osc2.start();
    osc1.stop(audioCtx.currentTime + 1);
    osc2.stop(audioCtx.currentTime + 1);
}

function playDaughterSound() {
    // ë°ê³  ìˆœìˆ˜í•œ ì†Œë¦¬ - ë†’ì€ í†¤ì˜ ìˆœìˆ˜í•œ ì‚¬ìš´ë“œ
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
    osc.frequency.exponentialRampToValueAtTime(554.37, audioCtx.currentTime + 1.5);
    gain.gain.setValueAtTime(0.12, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.5);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 1.5);
}

function playSausageSound() {
    // í˜¼ëˆìŠ¤ëŸ¬ìš´ ì†Œë¦¬ - ë¶ˆê·œì¹™í•œ í†¤ ë³€í™”
    const osc1 = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    const gain2 = audioCtx.createGain();
    
    osc1.type = 'sawtooth';
    osc1.frequency.setValueAtTime(200, audioCtx.currentTime);
    osc1.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.5);
    osc1.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 1);
    gain1.gain.setValueAtTime(0.08, audioCtx.currentTime);
    gain1.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
    
    osc2.type = 'square';
    osc2.frequency.setValueAtTime(300, audioCtx.currentTime);
    osc2.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.3);
    osc2.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 1);
    gain2.gain.setValueAtTime(0.06, audioCtx.currentTime);
    gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
    
    osc1.connect(gain1);
    osc2.connect(gain2);
    gain1.connect(audioCtx.destination);
    gain2.connect(audioCtx.destination);
    
    osc1.start();
    osc2.start();
    osc1.stop(audioCtx.currentTime + 1);
    osc2.stop(audioCtx.currentTime + 1);
}

function playNothingSound() {
    // ê³µí—ˆí•œ ì†Œë¦¬ - ë§¤ìš° ë‚®ê³  ê¸´ í†¤
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(55, audioCtx.currentTime); // A1
    osc.frequency.exponentialRampToValueAtTime(27.5, audioCtx.currentTime + 5);
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 5);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 5);
}


// ë°±ê·¸ë¼ìš´ë“œ ë¦¬ì†ŒìŠ¤ ë¡œë“œ í•¨ìˆ˜ (ë³„ë‹¤ë¥¸ ë¡œë”© ì—†ìŒ)
async function loadResourcesInBackground() {
    console.log("ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹œì‘...");
    // ì›¹ìº  ì‹œì‘ ë“± í•„ìš”í•œ ë¹„ë™ê¸° ì‘ì—… ê°€ëŠ¥ (ì§€ê¸ˆì€ ì—†ìŒ)
    console.log("ë°±ê·¸ë¼ìš´ë“œ ì¤€ë¹„ ì™„ë£Œ");
    return true; 
}


// ì´ˆê¸°í™” í•¨ìˆ˜
async function init() {
    // ì›¹ìº  ê¶Œí•œ ë¨¼ì € ìš”ì²­
    console.log("ì›¹ìº  ê¶Œí•œ ìš”ì²­ ì¤‘...");
    const webcamSuccess = await startWebcam();
    if (webcamSuccess) {
        console.log("ì›¹ìº  ê¶Œí•œ íšë“ ì™„ë£Œ");
    } else {
        console.log("ì›¹ìº  ê¶Œí•œ ê±°ë¶€ë¨ - ë§ˆì§€ë§‰ ì—”ë”©ì—ì„œ ì›¹ìº  ì‚¬ìš© ë¶ˆê°€");
    }
    
    // ë¹„ì£¼ì–¼/ì• ë‹ˆë©”ì´ì…˜ ë¨¼ì € ì‹œì‘
    handleSectionChange();
    animate();
    
    // ë°±ê·¸ë¼ìš´ë“œ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹œì‘ (await ì œê±°)
    loadResourcesInBackground(); 
}


document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>